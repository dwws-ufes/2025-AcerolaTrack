@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix time: <http://www.w3.org/2006/time#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dg: <https://w3id.org/dingo#> .
@prefix pto: <http://pto.example/ontology#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

# Mapping for Worker table
<#WorkerMapping>
    rr:logicalTable [ rr:tableName "worker" ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/worker/{id}";
        rr:class dg:Person;
    ];
    rr:predicateObjectMap [
        rr:predicate pto:hasRole;
        rr:objectMap [ 
            rr:template "https://w3id.org/dingo/role/{role}";
            rr:termType rr:IRI;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate foaf:name;
        rr:objectMap [ rr:column "username" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:active;
        rr:objectMap [ rr:column "active" ];
    ] .

# Mapping for Project table
<#ProjectTableMapping>
    rr:logicalTable [ rr:tableName "project" ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/project/{id}";
        rr:class dg:Project;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ rr:column "name" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:description;
        rr:objectMap [ rr:column "description" ];
    ];
    rr:predicateObjectMap [
        rr:predicate prov:wasAttributedTo;
        rr:objectMap [
            rr:parentTriplesMap <#CustomerMapping>;
            rr:joinCondition [
                rr:child "custumer_id";
                rr:parent "id";
            ];
        ];
    ] .

# Mapping for Customer table
<#CustomerMapping>
    rr:logicalTable [ rr:tableName "customer" ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/customer/{id}";
        rr:class dg:Person;
    ];
    rr:predicateObjectMap [
        rr:predicate foaf:name;
        rr:objectMap [ rr:column "name" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:identifier;
        rr:objectMap [ rr:column "cpf" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:active;
        rr:objectMap [ rr:column "active" ];
    ] .

# Mapping for TaskOld table (as task)
<#TaskMapping>
    rr:logicalTable [ rr:tableName "task" ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/task/{id}";
        rr:class pto:Task;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ rr:column "name" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:startTime;
        rr:objectMap [ 
            rr:column "start_time";
            rr:datatype xsd:dateTime;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:endTime;
        rr:objectMap [ 
            rr:column "end_time";
            rr:datatype xsd:dateTime;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate pto:partOfProject;
        rr:objectMap [
            rr:parentTriplesMap <#ProjectTableMapping>;
            rr:joinCondition [
                rr:child "project_id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:active;
        rr:objectMap [ 
            rr:template "false{cancelled}";
            rr:termType rr:Literal;
            rr:datatype xsd:boolean;
        ];
    ] .

# Mapeamento para relação Task-Worker
<#TaskWorkerMapping>
    rr:logicalTable [ 
        rr:sqlQuery """
            SELECT task_id, worker_id 
            FROM task_workers_join
        """
    ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/task/{task_id}";
    ];
    rr:predicateObjectMap [
        rr:predicate pto:assignedTo;
        rr:objectMap [
            rr:template "http://acerolatrack.org/worker/{worker_id}";
        ];
    ] .


# Mapeamento para TimeEntry
<#TimeEntryMapping>
    rr:logicalTable [ rr:tableName "time_entry" ];
    rr:subjectMap [
        rr:template "http://acerolatrack.org/timeentry/{id}";
        rr:class pto:TimeEntry;
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [ rr:column "description" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:startTime;
        rr:objectMap [ 
            rr:column "start_time";
            rr:datatype xsd:dateTime;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:endTime;
        rr:objectMap [ 
            rr:column "end_time";
            rr:datatype xsd:dateTime;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:duration;
        rr:objectMap [ 
            rr:column "total_time";
            rr:datatype xsd:integer;
        ];
    ];
    # Relação com Worker
    rr:predicateObjectMap [
        rr:predicate pto:recordedBy;
        rr:objectMap [
            rr:parentTriplesMap <#WorkerMapping>;
            rr:joinCondition [
                rr:child "worker_id";
                rr:parent "id";
            ];
        ];
    ];
    # Relação com Task
    rr:predicateObjectMap [
        rr:predicate pto:recordsWorkOn;
        rr:objectMap [
            rr:parentTriplesMap <#TaskMapping>;
            rr:joinCondition [
                rr:child "task_id";
                rr:parent "id";
            ];
        ];
    ] .